import y from"https://cdn.jsdelivr.net/npm/openai@4.0.0/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const w=new y({apiKey:prompt("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à API –∫–ª—é—á OpenAI:"),dangerouslyAllowBrowser:!0});var i=L.map("map").setView([0,0],2),l=[];L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(i);async function v(e,t){const r=`https://api.open-meteo.com/v1/forecast?latitude=${e}&longitude=${t}&hourly=temperature_2m,weathercode&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=7`;try{const o=await fetch(r);if(!o.ok)throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ API");return await o.json()}catch(o){return console.error("–û—à–∏–±–∫–∞:",o),null}}function I(e){return e<0?"–û—á–µ–Ω—å —Ö–æ–ª–æ–¥–Ω–æ! –ù–∞–¥–µ–Ω—å—Ç–µ —Ç–µ–ø–ª—É—é –∫—É—Ä—Ç–∫—É, —à–∞–ø–∫—É, —à–∞—Ä—Ñ –∏ –ø–µ—Ä—á–∞—Ç–∫–∏.":e<10?"–ü—Ä–æ—Ö–ª–∞–¥–Ω–æ. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–¥–µ—Ç—å –ø–∞–ª—å—Ç–æ –∏–ª–∏ –∫—É—Ä—Ç–∫—É.":e<20?"–£–º–µ—Ä–µ–Ω–Ω–æ —Ç–µ–ø–ª–æ. –ü–æ–¥–æ–π–¥–µ—Ç –ª–µ–≥–∫–∞—è –∫—É—Ä—Ç–∫–∞ –∏–ª–∏ —Å–≤–∏—Ç–µ—Ä.":e<25?"–¢–µ–ø–ª–æ. –ú–æ–∂–Ω–æ –Ω–∞–¥–µ—Ç—å —Ñ—É—Ç–±–æ–ª–∫—É –∏ –ª–µ–≥–∫–∏–µ –±—Ä—é–∫–∏ –∏–ª–∏ —é–±–∫—É.":"–ñ–∞—Ä–∫–æ! –ù–∞–¥–µ–Ω—å—Ç–µ –ª–µ–≥–∫—É—é –æ–¥–µ–∂–¥—É –∏ –Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –≥–æ–ª–æ–≤–Ω–æ–π —É–±–æ—Ä."}function m(e){return e<=3?"‚òÄÔ∏è":e<=48?"‚òÅÔ∏è":e<=77?"üåßÔ∏è":e<=82?"üå®Ô∏è":"‚õàÔ∏è"}async function $(e){try{const t=e.hourly.temperature_2m[new Date().getHours()],r=e.hourly.weathercode[new Date().getHours()];return(await w.chat.completions.create({model:"gpt-4",messages:[{role:"user",content:`–î–∞–π –∫–æ—Ä–æ—Ç–∫—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –ø–æ –æ–¥–µ–∂–¥–µ –¥–ª—è –ø–æ–≥–æ–¥—ã: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${t}¬∞C, –∫–æ–¥ –ø–æ–≥–æ–¥—ã ${r}`}],temperature:.7,max_tokens:300})).choices[0].message.content}catch(t){return console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –æ—Ç AI:",t),I(currentTemp)}}async function x(e){if(!e||!e.hourly)return"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–≥–æ–¥–µ";const t=new Date().getHours(),r=e.hourly.temperature_2m[t],o=e.hourly.weathercode[t],n=m(o),a=await $(e);let c=`<h3>–¢–µ–∫—É—â–∞—è –ø–æ–≥–æ–¥–∞: ${n} ${r.toFixed(1)}¬∞C</h3>`;c+=`<p>${a}</p>`,c+="<h4>–ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ 7 –¥–Ω–µ–π:</h4>";for(let s=0;s<7;s++){const d=new Date(e.daily.time[s]).toLocaleDateString(),f=e.daily.temperature_2m_min[s],g=e.daily.temperature_2m_max[s],h=m(e.daily.weathercode[s]);c+=`<p>${d}: ${h} ${f.toFixed(1)}¬∞C - ${g.toFixed(1)}¬∞C</p>`}return c}function M(){const e=l.map(t=>{const r=t.getLatLng();return{lat:r.lat,lng:r.lng}});localStorage.setItem("savedMarkers",JSON.stringify(e))}async function _(){const e=localStorage.getItem("savedMarkers");if(e){const t=JSON.parse(e);for(const r of t)await u(r.lat,r.lng)}}async function u(e,t){const r=await v(e,t);let o=`<h3>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${e}, ${t}</h3>`;o+=await x(r);const n=L.marker([e,t]).addTo(i).bindPopup(o).openPopup();l.push(n),p(),M()}i.on("click",async function(e){var t=e.latlng.lat.toFixed(4),r=e.latlng.lng.toFixed(4);u(t,r)});function p(){const e=document.getElementById("favorites");e.innerHTML="",l.forEach((t,r)=>{const o=document.createElement("li");o.textContent=`–õ–æ–∫–∞—Ü–∏—è ${r+1}: ${t.getLatLng().lat.toFixed(4)}, ${t.getLatLng().lng.toFixed(4)}`,o.onclick=()=>{i.setView(t.getLatLng(),10),t.openPopup()},e.appendChild(o)})}document.getElementById("citySearch").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("cityInput").value;try{const o=await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}`)).json();if(console.log(o),o&&o.length>0){const{lat:n,lon:a}=o[0];i.setView([n,a],10),u(n,a)}else alert("–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω")}catch(r){console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≥–æ—Ä–æ–¥–∞:",r),alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –≥–æ—Ä–æ–¥–∞")}});function k(){l.forEach(e=>{i.removeLayer(e)}),l=[],p(),localStorage.removeItem("savedMarkers")}document.getElementById("clearMarkers").addEventListener("click",k);document.addEventListener("DOMContentLoaded",()=>{_()});
